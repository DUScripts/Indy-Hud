{"slots":{"0":{"name":"core","type":{"events":[],"methods":[]}},"1":{"name":"slot2","type":{"events":[],"methods":[]}},"2":{"name":"slot3","type":{"events":[],"methods":[]}},"3":{"name":"slot4","type":{"events":[],"methods":[]}},"4":{"name":"slot5","type":{"events":[],"methods":[]}},"5":{"name":"slot6","type":{"events":[],"methods":[]}},"6":{"name":"slot7","type":{"events":[],"methods":[]}},"7":{"name":"slot8","type":{"events":[],"methods":[]}},"8":{"name":"slot9","type":{"events":[],"methods":[]}},"9":{"name":"slot10","type":{"events":[],"methods":[]}},"-1":{"name":"unit","type":{"events":[],"methods":[]}},"-3":{"name":"player","type":{"events":[],"methods":[]}},"-2":{"name":"construct","type":{"events":[],"methods":[]}},"-4":{"name":"system","type":{"events":[],"methods":[]}},"-5":{"name":"library","type":{"events":[],"methods":[]}}},"handlers":[{"code":"maxDist = 90 --export: Maximum render distance in meters.\nmaxPerFrame = 400 --export: Units drawn per render frame. Lower this if you are running other scripts too.\nmaxPerUpdate = 5\ndebugMode = false --export: Show debug data\nlocal a,b,c,d,e,f=system.print,string.format,math.floor,math.max,math.min,table.concat;local g=16777216;local function h(i)local j=i.x*Industry.cx;local k=i.y*Industry.cy;local l=i.z*Industry.cz;return j+k+l+Industry.worldPos end;local function m(n)return n==math.huge or n==-math.huge end;local function o(p,q)local r=10^(q or 0)return c(p*r+0.5)/r end;local function s(t)if t==nil or t~=t or t<1 or type(t)~=\"number\"then return\"00:00:00\"end;local u=c(t/3600)t=t-3600*u;local e=c(t/60)t=t-60*e;local v=o(t,0)local w=b(\"%02d:%02d:%02d\",u,e,v)return w end;local function x(y,z)return y.dist<z.dist end;Industry=(function()local A={i=0,cx=vec3(construct.getWorldOrientationRight()),cy=vec3(construct.getWorldOrientationForward()),cz=vec3(construct.getWorldOrientationUp()),ready=false,states={'STOPPED','RUNNING','NEEDS INGREDIENTS','OUTPUT FULL','NO OUTPUT LINK','PENDING','MISSING SCHEMATIC','SERVER ERROR'},allBlocks={},renderBlocks={},elemIndy={},sortedIndy={},totalUnits=0,totalUnrender=0,renderSize=0,lastFilter='r',searchActive=false,searches={},filters={1,1,1,1,1,1,1,1},cssBase=\"\"}function A.getCSS(B)B.cssBase=[[ <style> .indy{ position: absolute; display: block; color: #222; font-size: 0.89vh; opacity: 0.7; width: 18vh; text-transform:uppercase; } .fs-s{font-size:0.85em;} .bg-b .ii{background:#303030; color:#fff;} .grow{flex-grow:1;} .ii-row{display: flex;} .ii{display:inline-block; padding: 0.2rem 0.3rem; margin:0.08rem; margin-left:0; background:#eee;} .ib{border:1px solid #eee; color:#fff;} .ii-dist, .ii-indy{display:inline-block; transform: skew(-15deg); font-weight:900;} .ii-state{color:#fff;} .state-red{background:#892e2e;} .state-green{background:#338f47;} .state-orange{background:#958122;} .ii-tier{color:#fff;} .ii.tier-X{background:#666;} .ii.tier-1{background:#5494f7;} .ii.tier-2{background:#2977ef;} .ii.tier-3{background:#06f;} .ii.tier-4{background:#0152cd;} .ii.tier-5{background:#003991;} .ii-scale{} .ii-name{white-space: nowrap; overflow: hidden; text-overflow: ellipsis;} div.sks{padding:0.4em 0.5em; margin-top:0.5em; background:#3473BA; color:#fff; font-size:1.1em;} .legend{position:absolute; left:2vw; top:34.5vh; background:#fff; opacity:0.85; font-size:0.88vh; color:#222; z-index:999;} .legend h2{font-size:0.91vh; margin:0 0 0.2em 0; padding:0.15em 0.6em; background:#3473BA; color:#fff; font-weight:400;} p{color:#666; font-size:0.95em; padding:0em 0.3em; margin:0.2em 0.6em 0 0.6em; border-left:0.5em solid #3473BA;} ul{list-style:none; margin:0; padding:0.3em 0 0.2em 0;} ul li{margin-bottom:0.3em; padding:0.2em 0.6em;} li strong{background:#555; color:#f1f1f1; padding:0.2em 0.3em; margin-right:0.4em;} li span{background:#e1e1e1; color:#555; padding:0.2em 0.3em; margin-right:0.4em;} .svg{display:inline-block;} svg{width:100%;} svg,.svg{margin:0; padding:0;} li.]]..B.lastFilter..[[{background:#3473BA !important; color:#fff;} ]]..(B.searchActive and\"li.f1{background:#3473BA !important; color:#fff;}\"or\"\")..[[ </style> <div class=\"legend\"> <div class=\"svg\"><svg version=\"1.1\" viewBox=\"0 0 1024 84\" xml:space=\"preserve\"> <style type=\"text/css\"> .st0{fill:#3473BA;} .st1{fill:#FFFFFF;} .st2{font-family:'BankGothic';} .st3{font-size:46.69px; text-transform:uppercase;} </style> <rect class=\"st0\" width=\"100%\" height=\"90\"/> <g> <path class=\"st1\" d=\"M41.2,37.2c2.9-0.2,5.8,1,7.5,3.4c1.3,1.7,3.7,2.1,5.4,0.8c0,0,0.1,0,0.1-0.1l2.9-2.3c1.7-1.3,2-3.7,0.7-5.3 c-6.6-8.7-19.1-10.5-27.8-3.8s-10.5,19.1-3.8,27.8c3.7,4.9,9.6,7.9,15.8,7.9c4.3-0.1,8.5-1.5,12.1-4.1c5.1-3.5,10.2-9,19.9-16 c-4.2,1.1-8.4,2.4-12.5,4c-6.6,2.3-13.9,4.8-19.5,4.7c-4.7,0-8.5-3.8-8.5-8.5C33.5,41.2,36.9,37.5,41.2,37.2L41.2,37.2z\"/> <path class=\"st1\" d=\"M87,54.1c-2.9,0.2-5.8-1-7.5-3.4c-1.3-1.7-3.7-2.1-5.4-0.8c0,0-0.1,0-0.1,0.1l-2.9,2.3c-1.7,1.3-2,3.7-0.7,5.3 c6.6,8.8,19.1,10.5,27.8,3.9s10.5-19.1,3.9-27.8c-3.8-5-9.6-7.9-15.9-7.9c-4.3,0.1-8.5,1.5-12.1,4.1c-5.1,3.5-10.2,9-19.9,16 c4.2-1.1,8.4-2.4,12.5-4c6.6-2.3,13.9-4.8,19.5-4.7c4.7,0.2,8.3,4.2,8.1,8.8C94.2,50.2,91.1,53.6,87,54.1z\"/> </g> <text transform=\"matrix(1 0 0 1 126.19 57.85)\" class=\"st1 st2 st3\">Infinity Corporation</text> </svg></div> ]]if B.ready then B.cssBase=B.cssBase..[[ <h2>LUA TAB COMMANDS</h2> <p>TOTAL MACHINES: ]]..B.totalUnits..[[</p> <p>NOT RENDERED: ]]..B.totalUnrender..[[</p> ]]..(debugMode and\"<p>CHARACTER COUNT: \"..B.renderSize..\"</p>\"or\"\")..[[ <p>Search filters will stack until reset with R</p> <ul> <li class=\"a1\"><strong>A:1</strong><span>show 1</span>Stopped</li> <li class=\"a2\"><strong>A:2</strong><span>show 2</span>Running</li> <li class=\"a3\"><strong>A:3</strong><span>show 3</span>Miss Ingredients</li> <li class=\"a4\"><strong>A:4</strong><span>show 4</span>Output Full</li> <li class=\"a5\"><strong>A:5</strong><span>show 5</span>No Container Link</li> <li class=\"a6\"><strong>A:6</strong><span>show 6</span>Pending</li> <li class=\"a7\"><strong>A:7</strong><span>show 7</span>Miss Schematics</li> <li class=\"a8\"><strong>A:8</strong><span>show 8</span>Server Error Issue</li> <li class=\"a9\"><strong>A:9</strong><span>show errors</span>All Error Codes</li> <li class=\"r\"><strong>R</strong><span>show all</span>Reset All Filters</li> <li class=\"f1\"><span>find pure</span>Search For Output Products</li> <li class=\"f1\"><span>find assembly</span>Search By Machine Type</li> </ul> <div class=\"sks\">]]..f(B.searches,', ')..[[</div> ]]else B.cssBase=B.cssBase..[[ <h2>LOADING DATA</h2> <p>...</p> <div class=\"sks\"></div> ]]end;B.cssBase=B.cssBase..\"</div>\"end;function A.getARxy(B,C)local D=h(C.pos)local t={D.x,D.y,D.z}return library.getPointOnScreen(t)end;function A.sortItems(B)table.sort(B.sortedIndy)end;function A.filter(B,t)if t=='errors'then B.lastFilter='a9'for E,F in ipairs(B.filters)do B.filters[E]=0 end;B.filters[3]=1;B.filters[4]=1;B.filters[5]=1;B.filters[7]=1;B.filters[8]=1 elseif t=='all'then B.lastFilter='r'B.searchActive=false;B.searches={}for E,F in ipairs(B.filters)do B.filters[E]=1 end elseif type(t/1)=='number'then B.lastFilter='a'..t;for E,F in ipairs(B.filters)do B.filters[E]=0 end;B.filters[t/1]=1 end end;function A.find(B,t)B.searchActive=true;local G=t:lower()B.searches[#B.searches+1]=G end;function A.init(B)B.curTime=system.getArkTime()system.showScreen(1)system.setScreen(\"\")B.ready=false;B.worldPos=vec3(construct.getWorldPosition())B.Initializer=coroutine.create(B.initRun)B.Renderer=coroutine.create(B.render)B.Processor=coroutine.create(B.update)end;function A.coInit(B)local H=coroutine.status(B.Initializer)if H~=\"dead\"then local I,J=coroutine.resume(B.Initializer)if J then a(\"ERROR: \"..J)end end end;function A.initRun()local B=Industry;B.ready=false;local K=core.getElementIdList()local L={}for E=1,#K,1 do local M={uid=K[E],class=core.getElementClassById(K[E]),state=1,schemLeft=0,unitsDone=0,batchTotal=0,batchLeft=0,maintainTotal=0,maintainDone=0,products={}}if M.class:lower():sub(1,8)=='industry'then M.name=core.getElementNameById(K[E])M.kind=core.getElementDisplayNameById(K[E])M.class=core.getElementClassById(K[E])M.pos=vec3(core.getElementPositionById(K[E]))M.body=\"\"M.bodyTiny=\"\"M.dist=200;M.msgColor='orange'L['uid'..M.uid]=M else end end;B.elemIndy=L end;function A.makeBody(B,C)local N='red'if C.state==2 then N='green'end;if C.state==6 or C.state==1 then N='orange'end;C.msgColor=N;local O='X'local P='-'local Q=\"No selection\"local R=C.schemLeft and\"SCHEMS: \"..C.schemLeft or\"-\"if C.mainProduct and C.mainProduct.name then O=C.mainProduct.tier;P=C.mainProduct.scale;if P==''or not P then P='-'end;Q=C.mainProduct.name end;C.productName=Q;local S=\"NA\"if C.batchTotal>0 then S=\"BATCHES: \"..C.batchLeft..\" / \"..b(\"%.0f\",C.batchTotal)elseif C.maintainTotal>0 then S=\"MAINTAIN: \"..C.maintainDone..\" / \"..b(\"%.0f\",C.maintainTotal)end;C.bodyTiny=[[<div class=\"ii ib state-]]..N..[[\">]]..C.dist..[[m</div>]]C.body=[[ <div class=\"ii-row fs-s bg-b\"> <div class=\"ii ii-dist\">]]..C.dist..[[m</div><div class=\"ii ii-indy\">]]..C.name..[[</div> </div> <div class=\"ii-row\"> <div class=\"ii ii-state state-]]..N..[[ grow\">]]..B.states[C.state]..[[</div> </div> <div class=\"ii-row bg-g\"> <div class=\"ii ii-tier tier-]]..O..[[\">]]..O..[[</div><div class=\"ii ii-scale scale-l\">]]..P..[[</div><div class=\"ii ii-name grow\">]]..Q..[[</div> </div> <div class=\"ii-row fs-s\"> <div class=\"ii grow\">]]..S..[[</div><div class=\"ii\">]]..R..[[</div> </div> ]]end;function A.makeRender(B,C)if B.filters[C.state]==0 then return\"\"end;local T=B:getARxy(C)local U=T[2]*100;local V=T[1]*100;if V>90 or V<1 or(U>95 or U<1)then return\"\"end;C.dist=b(\"%.0f\",T[3])/1;local W=C.dist;if W>maxDist then return\"\"end;local X=1;X=100-W*10;local Y=\"\"Y=(100-W/2-35)/100;local Q=C.productName;local Z=true;if B.searchActive then for E,G in ipairs(B.searches)do if Q==\"No selection\"or Q:lower():find(G)==nil and C.kind:lower():find(G)==nil then Z=false end end end;if not Z then return\"\"end;local _=false;if U>49 and U<52 and V>48 and V<50 then Y=1;X=300-W*10;_=true end;local a0=\"\"if W<17 or W<=maxDist and _==true then X=200-W*10;Y=Y+0.35;a0=[[ <div class=\"indy\" style=\"z-index:]]..X..[[; opacity:]]..Y..[[; top: ]]..U..[[vh; left: ]]..V..[[vw;\"> ]]..C.body else Y=d(Y,0.45)a0=[[ <div class=\"indy\" style=\"z-index:]]..X..[[; opacity:]]..Y..[[; top: ]]..U..[[vh; left: ]]..V..[[vw;\"> <div class=\"ii ib state-]]..C.msgColor..[[\">]]..C.dist..[[m</div> ]]end;a0=a0 ..\"</div>\"return a0 end;function A.compile(B)end;function A.coRender(B)local H=coroutine.status(B.Renderer)if H~=\"dead\"then local I,J=coroutine.resume(B.Renderer)if J then a(\"ERROR: \"..J)end elseif H==\"dead\"then B.Renderer=coroutine.create(B.render)local I,J=coroutine.resume(B.Renderer)end end;function A.render()local B=Industry;B:getCSS()B.renderBlocks={}B.renderBlocks[1]=B.cssBase;local E=1;if B.ready then for a1,C in pairs(B.elemIndy)do local a2=B:makeRender(C)E=E+1;if a2~=\"\"then B.renderBlocks[#B.renderBlocks+1]=a2 end;if math.fmod(E,maxPerFrame)==0 then coroutine.yield()end end end;local a3=#B.renderBlocks-1;B.totalUnrender=B.totalUnits-a3;local a0=table.concat(B.renderBlocks)B.renderSize=a0:len()system.setScreen(a0)end;function A.coUpdate(B)local H=coroutine.status(B.Processor)if H~=\"dead\"then local I,J=coroutine.resume(B.Processor)if J then a(\"ERROR: \"..J)end elseif H==\"dead\"then B.Processor=coroutine.create(B.update)local I,J=coroutine.resume(B.Processor)end end;function A.update()local B=Industry;local a4=0;for a5,C in pairs(B.elemIndy)do local a6=core.getElementIndustryInfoById(C.uid)if not a6 then a(C.uid..' had no data')else C.name=core.getElementNameById(C.uid)C.kind=core.getElementDisplayNameById(C.uid)C.class=core.getElementClassById(C.uid)C.state=a6.state;C.schemLeft=a6.schematicsRemaining;C.unitsDone=a6.unitsProduced;C.batchTotal=a6.batchesRequested;C.batchLeft=a6.batchesRemaining;C.maintainTotal=a6.maintainProductAmount;C.maintainDone=a6.currentProductAmount;C.products=a6.currentProducts;C.timeLeft=a6.remainingTime;C.mainProduct={}if C.maintainDone>=g then C.maintainDone=c(C.maintainDone/g)end;if C.products and#C.products>0 then C.mainProduct=C.products[1]local a7=system.getItem(C.mainProduct.id)C.mainProduct.name=a7.locDisplayName;C.mainProduct.type=a7.type;C.mainProduct.tier=a7.tier;C.mainProduct.scale=a7.size;C.mainProduct.icon=a7.iconPath end;B:makeBody(C)end;a4=a4+1;if math.fmod(a4,maxPerUpdate)==0 then coroutine.yield()end end;B.totalUnits=a4;B.ready=true end;return A end)()Commands=(function()local A={active=false,label='Listen to Voice',timed=0,lastCMD='',list={show={desc=' [1 to 9, show specific message matches]',fn=function(B,a8)local t=a8[2]Industry:filter(t)end},find={desc=' [search key, find machines or outputs]',fn=function(B,a8)local a9=table.remove(a8,1)local F=table.concat(a8,' ')Industry:find(F)end}}}function A.init(B)B.helps={}for a8,aa in pairs(B.list)do if aa.desc then aa.name=a8;B.helps[#B.helps+1]=a8 end end;table.sort(B.helps)end;function A.key(B,ab)local a5=ab:sub(7,8)local type=ab:sub(1,6)if a5=='9'then B:call('show errors')elseif ab=='r'then B:call('show all')elseif type=='option'then B:call('show '..a5)end end;function A.help(B)a('----------------------------')a('- twitch.tv/codeinfused')a('- tinyurl.com/indyhud')a('----------------------------')a('- INDY HUD BY CODEINFUSED v1.1')a('- COMMANDS')for E,ac in ipairs(B.helps)do a(ac..B.list[ac].desc)end;a('----------------------------')end;function A.call(B,ad,ae)local a8={}for C in ad:gmatch(\"%S+\")do table.insert(a8,C)end;local t=string.lower(a8[1])if t=='help'then B:help()elseif B.list[t]then B.list[t].fn(B,a8,ae)end end;return A end)()Industry:init()Commands:init()Commands:help()","filter":{"args":[],"signature":"onStart()","slotKey":"-1"},"key":"0"},{"code":"Industry:coInit()\nIndustry:coUpdate()\nIndustry:coRender()\n--collectgarbage(\"collect\")","filter":{"args":[],"signature":"onUpdate()","slotKey":"-4"},"key":"1"},{"code":"Commands:call(text)","filter":{"args":[{"variable":"*"}],"signature":"onInputText(text)","slotKey":"-4"},"key":"2"},{"code":"if action:sub(1,6)=='option' then\n  Commands:key(action)\nelseif action=='speedup' then\n  Commands:key('r')\nend","filter":{"args":[{"variable":"*"}],"signature":"onActionStart(action)","slotKey":"-4"},"key":"3"}],"methods":[],"events":[]}
