{"slots":{"0":{"name":"core","type":{"events":[],"methods":[]}},"1":{"name":"slot2","type":{"events":[],"methods":[]}},"2":{"name":"slot3","type":{"events":[],"methods":[]}},"3":{"name":"slot4","type":{"events":[],"methods":[]}},"4":{"name":"slot5","type":{"events":[],"methods":[]}},"5":{"name":"slot6","type":{"events":[],"methods":[]}},"6":{"name":"slot7","type":{"events":[],"methods":[]}},"7":{"name":"slot8","type":{"events":[],"methods":[]}},"8":{"name":"slot9","type":{"events":[],"methods":[]}},"9":{"name":"slot10","type":{"events":[],"methods":[]}},"-1":{"name":"unit","type":{"events":[],"methods":[]}},"-3":{"name":"player","type":{"events":[],"methods":[]}},"-2":{"name":"construct","type":{"events":[],"methods":[]}},"-4":{"name":"system","type":{"events":[],"methods":[]}},"-5":{"name":"library","type":{"events":[],"methods":[]}}},"handlers":[{"code":"maxDist = 70 --export: Maximum render distance in meters. Affects FPS.\nmaxPerFrame = 340 --export: Units drawn per render frame. Lower this if you are running other scripts too.\nfontSize = 0.94 --export: Recommended = 0.94, large = 1.2\nminimumOpacity = 0.45 --export: Lowest opacity of distant units. Range of zero to 1.\nshowContainers = false --export: Show containers in AR view and filters.\nshowRecipes = false --export: Show recipe list in the detail view box.\ndebugMode = false --export: Show debug data.\nKeyShift = false\nKeyAlt = false\nmaxPerUpdate = 10\nlocal a,b,c,d,e,f=system.print,string.format,math.floor,math.max,math.min,table.concat;local g=16777216;local function h(i)local j=i.x*Industry.cx;local k=i.y*Industry.cy;local l=i.z*Industry.cz;return j+k+l+Industry.worldPos end;local function m(n)return n==math.huge or n==-math.huge end;local function o(p,q)local r=10^(q or 0)return c(p*r+0.5)/r end;local function s(t)if t==nil or t~=t or t<1 or type(t)~=\"number\"then return\"00:00:00\"end;local u=c(t/3600)t=t-3600*u;local e=c(t/60)t=t-60*e;local v=o(t,0)local w=b(\"%02d:%02d:%02d\",u,e,v)return w end;local function x(y,z)return y.dist<z.dist end;Industry=(function()local A={i=0,cx=vec3(construct.getWorldOrientationRight()),cy=vec3(construct.getWorldOrientationForward()),cz=vec3(construct.getWorldOrientationUp()),pPos=vec3(player.getWorldPosition()),loaded=false,ready=false,states={'STOPPED','RUNNING','NEEDS INGREDIENTS','OUTPUT FULL','NO OUTPUT LINK','PENDING','MISSING SCHEMATIC','SERVER ERROR'},allBlocks={},renderBlocks={},elemIndy={},renderIndy={},totalUnits=0,totalUnrender=0,matchesFound=0,renderSize=0,lastFilter='r',searchActive=false,searches={},filters={1,1,1,1,1,1,1,1},cssStatic=[[ <style> .indy{ position: absolute; display: block; color: #222; font-size: ]]..fontSize..[[vh; opacity: 0.7; width: ]]..20*fontSize..[[vh; text-transform:uppercase; transform-origin: 0 0; } .fs-s{font-size:0.92em;} .bg-b .ii{background:#303030; color:#fff;} .bg-k .ii{background:#666; color:#f1f1f1;} .grow{flex-grow:1;} .ii-row{display: flex;} .ii{display:inline-block; padding: 0.2rem 0.3rem; margin:0.08rem; margin-left:0; background:#eee;} .ib{border:1px solid #eee; color:#fff; text-transform:lowercase;} .ic{text-transform:lowercase;} .ii-dist, .ii-indy{display:inline-block; transform: skew(-15deg); font-weight:900;} .ii-st{color:#fff;} .st-red{background:#892e2e;} .st-green{background:#338f47;} .st-orange{background:#958122;} .ii-tier{color:#fff;} .ii.tier-X{background:#666;} .ii.tier-1{background:#5494f7;} .ii.tier-2{background:#2977ef;} .ii.tier-3{background:#06f;} .ii.tier-4{background:#0152cd;} .ii.tier-5{background:#003991;} .ii-name{white-space: nowrap; overflow: hidden; text-overflow: ellipsis;} .ii-rb{background:#cacaca; color:#333;} div.sks{padding:0.4em 0.5em; margin-top:0.5em; background:#3473BA; color:#fff; font-size:1.1em;} .legend{position:absolute; left:2vw; top:]]..27-80*(fontSize-0.91)..[[vh; background:#fff; opacity:0.85; font-size:]]..fontSize..[[vh; color:#222; z-index:999;} .legend h2{font-size:]]..fontSize..[[vh; margin:0 0 0.2em 0; padding:0.15em 0.6em; background:#3473BA; color:#fff; font-weight:400;} .legend > p{color:#666; font-size:0.95em; line-height:1.0; padding:0em 0.3em; margin:0.4em 0.6em 0 0.6em; border-left:0.5em solid #3473BA;} ul{list-style:none; margin:0; padding:0.6em 0 0.2em 0;} ul li{margin-bottom:0.3em; padding:0.2em 0.6em;} li strong{background:#555; color:#f1f1f1; padding:0.2em 0.3em; margin-right:0.4em;} li span{background:#e1e1e1; color:#555; padding:0.2em 0.3em; margin-right:0.4em;} li span.on{background:#338f47; color:#fff;} li span.off{background:#777; color:#ccc;} .svg{display:inline-block;} svg{width:100%;} svg,.svg{margin:0; padding:0;} ]],cssBase=\"\"}local B={}function A.getCSS(C)C.cssBase=C.cssStatic..[[ li.]]..C.lastFilter..[[{background:#3473BA !important; color:#fff;} ]]..(C.searchActive and\"li.f1{background:#3473BA !important; color:#fff;}\"or\"\")..[[ </style> <div class=\"legend\"> <div class=\"svg\"><svg version=\"1.1\" viewBox=\"0 0 1024 84\" xml:space=\"preserve\"> <style type=\"text/css\"> .st0{fill:#3473BA;} .st1{fill:#FFFFFF;} .st2{font-family:'BankGothic';} .st3{font-size:46.69px; text-transform:uppercase;} </style> <rect class=\"st0\" width=\"100%\" height=\"90\"/> <g> <path class=\"st1\" d=\"M41.2,37.2c2.9-0.2,5.8,1,7.5,3.4c1.3,1.7,3.7,2.1,5.4,0.8c0,0,0.1,0,0.1-0.1l2.9-2.3c1.7-1.3,2-3.7,0.7-5.3 c-6.6-8.7-19.1-10.5-27.8-3.8s-10.5,19.1-3.8,27.8c3.7,4.9,9.6,7.9,15.8,7.9c4.3-0.1,8.5-1.5,12.1-4.1c5.1-3.5,10.2-9,19.9-16 c-4.2,1.1-8.4,2.4-12.5,4c-6.6,2.3-13.9,4.8-19.5,4.7c-4.7,0-8.5-3.8-8.5-8.5C33.5,41.2,36.9,37.5,41.2,37.2L41.2,37.2z\"/> <path class=\"st1\" d=\"M87,54.1c-2.9,0.2-5.8-1-7.5-3.4c-1.3-1.7-3.7-2.1-5.4-0.8c0,0-0.1,0-0.1,0.1l-2.9,2.3c-1.7,1.3-2,3.7-0.7,5.3 c6.6,8.8,19.1,10.5,27.8,3.9s10.5-19.1,3.9-27.8c-3.8-5-9.6-7.9-15.9-7.9c-4.3,0.1-8.5,1.5-12.1,4.1c-5.1,3.5-10.2,9-19.9,16 c4.2-1.1,8.4-2.4,12.5-4c6.6-2.3,13.9-4.8,19.5-4.7c4.7,0.2,8.3,4.2,8.1,8.8C94.2,50.2,91.1,53.6,87,54.1z\"/> </g> <text transform=\"matrix(1 0 0 1 126.19 57.85)\" class=\"st1 st2 st3\">Infinity Corporation</text> </svg></div> ]]if C.ready then C.cssBase=C.cssBase..[[ <h2>LUA TAB COMMANDS</h2> <p>TOTAL ELEMENTS: ]]..C.totalUnits..[[</p> <p>RENDERED: ]]..C.renderCt..[[</p> <p>MATCHES IN RANGE: ]]..C.matchesFound..[[</p> <p>Search filters will stack until reset with R</p> <ul> <li class=\"a1\"><strong>A:1</strong><span>show 1</span>Stopped</li> <li class=\"a2\"><strong>A:2</strong><span>show 2</span>Running</li> <li class=\"a3\"><strong>A:3</strong><span>show 3</span>Miss Ingredients</li> <li class=\"a4\"><strong>A:4</strong><span>show 4</span>Output Full</li> <li class=\"a5\"><strong>A:5</strong><span>show 5</span>No Container Link</li> <li class=\"a6\"><strong>A:6</strong><span>show 6</span>Pending</li> <li class=\"a7\"><strong>A:7</strong><span>show 7</span>Miss Schematics</li> <li class=\"a8\"><strong>A:8</strong><span>show 8</span>Server Error Issue</li> <li class=\"a9\"><strong>A:9</strong><span>show errors</span>All Error Codes</li> <li class=\"r\"><strong>R</strong><span>show all</span>Reset All Filters</li> <li class=\"f1\"><span>find pure</span>Search For Output Products</li> <li class=\"f1\"><span>find assembly</span>Search By Machine Type</li> </ul> <div class=\"sks\">]]..f(C.searches,', ')..[[</div> <h2>OTHER OPTIONS</h2> <ul> <li><strong>S:G</strong><span class=\"]]..(showContainers and\"on\"or\"off\")..[[\">]]..(showContainers and\"on\"or\"off\")..[[</span>Include Containers</li> <li><strong>S:L</strong><span class=\"]]..(showRecipes and\"on\"or\"off\")..[[\">]]..(showRecipes and\"on\"or\"off\")..[[</span>Show Recipes</li> <li><strong>S:R</strong>Reload the HUD</li> </ul> ]]else C.cssBase=C.cssBase..[[ <h2>LOADING DATA</h2> <p>...</p> <div class=\"sks\"></div> ]]end;C.cssBase=C.cssBase..\"</div>\"end;function A.getARxy(C,D)local t={D.pos.x,D.pos.y,D.pos.z}return library.getPointOnScreen(t)end;function A.sortItems(C)table.sort(C.sortedIndy)end;function A.filter(C,t)if t=='errors'then C.lastFilter='a9'for E,F in ipairs(C.filters)do C.filters[E]=0 end;C.filters[3]=1;C.filters[4]=1;C.filters[5]=1;C.filters[7]=1;C.filters[8]=1 elseif t=='all'then C.lastFilter='r'C.searchActive=false;C.searches={}for E,F in ipairs(C.filters)do C.filters[E]=1 end elseif type(t/1)=='number'then C.lastFilter='a'..t;for E,F in ipairs(C.filters)do C.filters[E]=0 end;C.filters[t/1]=1 end end;function A.find(C,t)C.searchActive=true;local G=t:lower()C.searches[#C.searches+1]=G end;function A.init(C)C.curTime=system.getArkTime()system.showScreen(1)system.setScreen(\"\")C.ready=false;C.loaded=false;C.worldPos=vec3(construct.getWorldPosition())C.Initializer=coroutine.create(C.initRun)C.Renderer=coroutine.create(C.render)C.Processor=coroutine.create(C.update)C.Organizer=coroutine.create(C.organize)end;function A.coInit(C)local H=coroutine.status(C.Initializer)if H~=\"dead\"then local I,J=coroutine.resume(C.Initializer)if J then a(\"ERROR: \"..J)end end end;function A.initRun()local C=Industry;local K=core.getElementIdList()local L={}for E=1,#K,1 do local M={uid=K[E],class=core.getElementClassById(K[E]),state=0,schemLeft=0,unitsDone=0,batchTotal=0,batchLeft=0,maintainTotal=0,maintainDone=0,products={}}local N=M.class:lower():sub(1,8)if N=='industry'or N=='containe'then M.name=core.getElementNameById(K[E])M.class=N;M.kind=core.getElementDisplayNameById(K[E])if M.class=='industry'then M.pos=vec3(core.getElementPositionById(K[E]))+vec3(core.getElementUpById(K[E]))else M.pos=vec3(core.getElementPositionById(K[E]))+vec3(core.getElementUpById(K[E]))/2;M.productName=M.name end;M.pos=vec3(h(M.pos))M.body=\"\"M.bodyTiny=\"\"M.dist=200;M.msgColor='orange'L['uid'..M.uid]=M else end;if math.fmod(E,maxPerFrame)==0 then coroutine.yield()end end;C.elemIndy=L;C.renderIndy={}C.loaded=true end;function A.makeContainer(C,D)D.bodyTiny=[[<div class=\"ii ic\">]]..D.dist..[[m</div>]]D.body=[[ <div class=\"ii-row fs-s bg-b\"> <div class=\"ii ii-dist\">]]..D.dist..[[m</div><div class=\"ii ii-indy\">Container</div> </div> <div class=\"ii-row\"> <div class=\"ii\">]]..D.name..[[</div> </div> ]]end;function A.makeBody(C,D)local O='red'if D.state==2 then O='green'end;if D.state==6 or D.state==1 then O='orange'end;D.msgColor=O;local P='X'local Q='-'local R=\"No selection\"local S=D.schemLeft and\"SCHEMS: \"..D.schemLeft or\"-\"local T=false;if D.mainProduct and D.mainProduct.name then P=D.mainProduct.tier;Q=D.mainProduct.scale;if Q==''or not Q then Q='-'end;R=D.mainProduct.name;T=D.mainProduct.prid end;D.productName=R;local U=\"NA\"if D.batchTotal>0 then U=\"BATCHES: \"..D.batchLeft..\" / \"..b(\"%.0f\",D.batchTotal)elseif D.maintainTotal>0 then U=\"MAINTAIN: \"..D.maintainDone..\" / \"..b(\"%.0f\",D.maintainTotal)end;D.bodyTiny=[[<div class=\"ii ib st-]]..O..[[\">]]..D.dist..[[m</div>]]D.body=[[ <div class=\"ii-row fs-s bg-b\"> <div class=\"ii ii-dist\">]]..D.dist..[[m</div><div class=\"ii ii-indy\">]]..D.name..[[</div> </div> <div class=\"ii-row\"> <div class=\"ii ii-st st-]]..O..[[ grow\">]]..C.states[D.state]..[[</div> </div> <div class=\"ii-row bg-g\"> <div class=\"ii ii-tier tier-]]..P..[[\">]]..P..[[</div><div class=\"ii scale-l\">]]..Q..[[</div><div class=\"ii ii-name grow\">]]..R..[[</div> </div> <div class=\"ii-row fs-s\"> <div class=\"ii grow\">]]..U..[[</div><div class=\"ii\">]]..S..[[</div> </div> ]]if showRecipes and T and D.kind:lower():find('transfer unit')==nil then D.body=D.body..[[ <div class=\"ii-row fs-s\"> <div class=\"ii ii-rb grow\">]]..f(B[T],\", \")..[[</div> </div> ]]end end;function A.makeRender(C,D)local V=C:getARxy(D)local W=V[2]*100;local X=V[1]*100;if X>94 or X<1 or(W>96 or W<1)then return\"\"end;D.dist=c(V[3])local Y=D.dist;local Z=1;Z=100-Y*10;local _=\"\"_=(100-Y/1.5-5)/100;local a0=75;a0=a0+40*(maxDist-Y)/maxDist;a0=a0/100;local a1=''local R=D.productName;if D.class=='containe'then a1='bg-k'end;local a2=false;if W>49 and W<50.25 and X>48.5 and X<49.5 then _=0.99;Z=300-Y*10;a2=true end;local a3=\"\"if Y<=8 or Y<=maxDist and a2==true then Z=200-Y*10;a3=[[ <div class=\"indy ]]..a1 ..[[\" style=\"z-index:]]..c(Z)..[[; opacity:]].._..[[; top: ]]..W..[[vh; left: ]]..X..[[vw;\"> ]]..D.body else _=d(_,minimumOpacity)if D.class=='containe'then _=d(_-0.2,minimumOpacity)end;a3=[[ <div class=\"indy ]]..a1 ..[[\" style=\"z-index:]]..c(Z)..[[; opacity:]].._..[[; top: ]]..W..[[vh; left: ]]..X..[[vw; transform:scale(]]..a0 ..[[);\"> <div class=\"ii ib st-]]..D.msgColor..[[\">]]..D.dist..[[m</div> ]]end;a3=a3 ..\"</div>\"return a3 end;function A.coRender(C)if not C.loaded then return end;local H=coroutine.status(C.Renderer)if H~=\"dead\"then local I,J=coroutine.resume(C.Renderer)if J then a(\"ERROR: \"..J)end elseif H==\"dead\"then C.Renderer=coroutine.create(C.render)local I,J=coroutine.resume(C.Renderer)end end;function A.render()local C=Industry;C.pPos=vec3(player.getWorldPosition())C:getCSS()C.renderBlocks={}C.renderBlocks[1]=C.cssBase;local E=1;if C.ready then for a4,a5 in pairs(C.renderIndy)do local a6=C:makeRender(C.elemIndy[a5])E=E+1;if a6~=\"\"then C.renderBlocks[#C.renderBlocks+1]=a6 end;if math.fmod(E,maxPerFrame)==0 then coroutine.yield()end end end;local a7=#C.renderBlocks-1;C.renderCt=a7;local a3=table.concat(C.renderBlocks)C.renderSize=a3:len()system.setScreen(a3)end;function A.coOrganize(C)if not C.loaded or not C.ready then return end;local H=coroutine.status(C.Organizer)if H~=\"dead\"then local I,J=coroutine.resume(C.Organizer)if J then a(\"ERROR: \"..J)end elseif H==\"dead\"then C.Organizer=coroutine.create(C.organize)local I,J=coroutine.resume(C.Organizer)end end;function A.organize()local C=Industry;local a8=c(maxPerFrame/4)local a9=0;local aa={}local E=0;if C.ready then for a5,D in pairs(C.elemIndy)do E=E+1;local ab=true;local Y=C.pPos:dist(vec3(D.pos))if Y>maxDist then ab=false elseif D.class=='containe'then if not showContainers then ab=false else local ac=true;local R=D.productName:lower()if C.searchActive then for E,G in ipairs(C.searches)do if R==\"no selection\"or R:find(G)==nil and D.kind:lower():find(G)==nil then ac=false end end end;if not ac then ab=false end end elseif C.filters[D.state]==0 then ab=false else local ac=true;local R=D.productName:lower()if C.searchActive then for E,G in ipairs(C.searches)do if R==\"no selection\"or R:find(G)==nil and D.kind:lower():find(G)==nil then ac=false end end end;if not ac then ab=false end end;if ab==true then if D.class~='containe'then a9=a9+1 end;aa[#aa+1]=a5 end;if math.fmod(E,a8)==0 then coroutine.yield()end end end;C.renderIndy=aa;C.matchesFound=a9 end;function A.coUpdate(C)if not C.loaded then return end;local H=coroutine.status(C.Processor)if H~=\"dead\"then local I,J=coroutine.resume(C.Processor)if J then a(\"ERROR: \"..J)end elseif H==\"dead\"then C.Processor=coroutine.create(C.update)local I,J=coroutine.resume(C.Processor)end end;function A.update()local C=Industry;local ad=0;for a5,D in pairs(C.elemIndy)do local ae=core.getElementIndustryInfoById(D.uid)if not ae or D.class=='containe'then C:makeContainer(D)else D.name=core.getElementNameById(D.uid)D.state=ae.state;D.schemLeft=ae.schematicsRemaining;D.unitsDone=ae.unitsProduced;D.batchTotal=ae.batchesRequested;D.batchLeft=ae.batchesRemaining;D.maintainTotal=ae.maintainProductAmount;D.maintainDone=ae.currentProductAmount;D.products=ae.currentProducts;D.timeLeft=ae.remainingTime;D.mainProduct={}if D.maintainDone>=g then D.maintainDone=c(D.maintainDone/g)end;if D.products and#D.products>0 then D.mainProduct=D.products[1]local af=D.mainProduct.id;local ag=system.getItem(af)D.mainProduct.name=ag.locDisplayName;D.mainProduct.tier=ag.tier;D.mainProduct.scale=ag.size;local ah='p'..af;D.mainProduct.prid=ah;if not B[ah]then local ai=system.getRecipes(af)local aj={}if#ai>0 then for ak,al in pairs(ai[1].ingredients)do local am=system.getItem(al.id)aj[#aj+1]=am.locDisplayName end end;B[ah]=aj end end;C:makeBody(D)end;ad=ad+1;if math.fmod(ad,maxPerUpdate)==0 then coroutine.yield()end end;C.totalUnits=ad;C.ready=true end;return A end)()Commands=(function()local A={active=false,label='Listen to Voice',timed=0,lastCMD='',list={show={desc=' [1 to 9, show specific message matches]',fn=function(C,an)local t=an[2]Industry:filter(t)end},find={desc=' [search key, find machines or outputs]',fn=function(C,an)local ao=table.remove(an,1)local F=table.concat(an,' ')Industry:find(F)end}}}function A.init(C)C.helps={}for an,ap in pairs(C.list)do if ap.desc then ap.name=an;C.helps[#C.helps+1]=an end end;table.sort(C.helps)end;function A.key(C,aq)local a5=aq:sub(7,8)local type=aq:sub(1,6)if a5=='9'then C:call('show errors')elseif aq=='speedup'then if KeyShift then Industry:init()else C:call('show all')end elseif aq=='lshift'then KeyShift=true elseif aq=='lalt'then KeyAlt=true elseif aq=='gear'then if KeyShift then showContainers=not showContainers end elseif aq=='light'then if KeyShift then showRecipes=not showRecipes end elseif type=='option'then C:call('show '..a5)end end;function A.keyStop(C,aq)if aq=='lshift'then KeyShift=false elseif aq=='lalt'then KeyAlt=false end end;function A.help(C)a('----------------------------')a('- twitch.tv/codeinfused')a('- tinyurl.com/indyhud')a('----------------------------')a('- INDY HUD BY CODEINFUSED v1.2')a('- COMMANDS')for E,ar in ipairs(C.helps)do a(ar..C.list[ar].desc)end;a('----------------------------')end;function A.call(C,as,at)local an={}for D in as:gmatch(\"%S+\")do table.insert(an,D)end;local t=string.lower(an[1])if t=='help'then C:help()elseif C.list[t]then C.list[t].fn(C,an,at)end end;return A end)()Industry:init()Commands:init()Commands:help()","filter":{"args":[],"signature":"onStart()","slotKey":"-1"},"key":"0"},{"code":"Industry:coInit()\nIndustry:coUpdate()\nIndustry:coOrganize()\nIndustry:coRender()\ncollectgarbage(\"collect\")","filter":{"args":[],"signature":"onUpdate()","slotKey":"-4"},"key":"1"},{"code":"Commands:call(text)","filter":{"args":[{"variable":"*"}],"signature":"onInputText(text)","slotKey":"-4"},"key":"2"},{"code":"--[[if action:sub(1,6)=='option' then\n  Commands:key(action)\nelseif action=='speedup' then\n  Commands:key('r')\nelseif action=='gear' then\nend\n]]\nCommands:key(action)","filter":{"args":[{"variable":"*"}],"signature":"onActionStart(action)","slotKey":"-4"},"key":"3"},{"code":"Commands:keyStop(action)","filter":{"args":[{"variable":"*"}],"signature":"onActionStop(action)","slotKey":"-4"},"key":"4"}],"methods":[],"events":[]}